const LabsInfo = [
  {
    id: 'l0001',
    name: 'Лаборатория экспериментальной гидропоники и органического земледелия',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/sUnp5bA-xd4" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0002',
    name: 'Ветеринарная клиника',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/_QxIi8Wvecs" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0003',
    name: 'Лаборатория инновационных технологий пищевых производств',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/pIc5B9hSG54" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0004',
    name: 'Лаборатория ветеринарной иммунологии и морфологии',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/I2bYrtWmyyc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0005',
    name: 'Лаборатория диагностики качества кормов и разведения сельскохозяйственных животных им. Л.К. Эрнста',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/AOR3NR6asM0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0006',
    name: 'Патологоанатомический музей ветеринарного факультета',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/-Nb_zmG--Xk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0007',
    name: 'Аналитическая лаборатория',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/P1KLW_SGQYI" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0008',
    name: 'Музей истории Академии',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/2_iprKd_3Sg" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0009',
    name: 'Лаборатория коневодства',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/apYX7zCAR0U" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0010',
    name: 'Корпоративная аудитория ОАО "Минский тракторный завод"',
    code: '<iframe width="560" height="315" loading="lazy" src="https://www.youtube.com/embed/jrH8MMS-sdg" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0011',
    name: 'Фирменная аудитория "Зеленая экономика" ПАО "Сбербанк"',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/msOnOL0paYQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0012',
    name: 'Фирменная аудитория АО "РСХБ"',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/qVDvz1NEsL8" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0013',
    name: 'Лаборатория эвристики ЦНО "Агрополис"',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/rwBVliF57tA" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  },
  {
    id: 'l0014',
    name: 'Фирменная аудитория ЗАО "НПП Фармакс"',
    code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/Pjab4FJKxr0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'
  }
];

const BadgesInfo = [
  {
    id: 'b0001',
    name: 'Министерство сельского хозяйства Российской федерации',
    code: '<object data="https://vgsha.info/wp-content/uploads/docs/nagrady/" type="application/pdf"><embed src="https://vgsha.info/wp-content/uploads/docs/nagrady/" type="application/pdf"><p>Информация скоро появится</p></embed></object>'
  },
  {
    id: 'b0002',
    name: 'Законодательное собрание Кировской области',
    code: '<object data="https://vgsha.info/wp-content/uploads/docs/nagrady/zak_sobranie.pdf" type="application/pdf"><embed src="https://vgsha.info/wp-content/uploads/docs/nagrady/zak_sobranie.pdf" type="application/pdf"/></object>'
  },
  {
    id: 'b0003',
    name: 'Кировский молочный комбинат',
    code: '<object data="https://vgsha.info/wp-content/uploads/docs/nagrady/" type="application/pdf"><embed src="https://vgsha.info/wp-content/uploads/docs/nagrady/" type="application/pdf"><p>Информация скоро появится</p></embed></object>'
  },
  {
    id: 'b0004',
    name: 'Комитет по аграрно-производственной политике и природопользованию Совета Федерации РФ',
    code: '<object data="https://vgsha.info/wp-content/uploads/docs/nagrady/" type="application/pdf"><embed src="https://vgsha.info/wp-content/uploads/docs/nagrady/" type="application/pdf"><p>Информация скоро появится</p></embed></object>'
  },
  {
    id: 'b0005',
    name: 'Кировская городская Дума',
    code: '<object data="https://vgsha.info/wp-content/uploads/docs/nagrady/kirov_duma.pdf" type="application/pdf"><embed src="https://vgsha.info/wp-content/uploads/docs/nagrady/kirov_duma.pdf" type="application/pdf"/></object>'
  },
  {
    id: 'b0006',
    name: 'Администрация муниципального образования "город Киров"',
    code: '<object data="https://vgsha.info/wp-content/uploads/docs/nagrady/gorod_kirov.pdf" type="application/pdf"><embed src="https://vgsha.info/wp-content/uploads/docs/nagrady/gorod_kirov.pdf" type="application/pdf"/></object>'
  },
  {
    id: 'b0007',
    name: 'Министерство сельского хозяйства и продовольствия Кировской области',
    code: '<object data="https://vgsha.info/wp-content/uploads/docs/nagrady/minselhoz.pdf" type="application/pdf"><embed src="https://vgsha.info/wp-content/uploads/docs/nagrady/minselhoz.pdf" type="application/pdf"/></object>'
  },
  {
    id: 'b0008',
    name: 'Правительство Кировской области',
    code: '<object data="https://vgsha.info/wp-content/uploads/docs/nagrady/pravitelstvo_ko.pdf" type="application/pdf"><embed src="https://vgsha.info/wp-content/uploads/docs/nagrady/pravitelstvo_ko.pdf" type="application/pdf"/></object>'
  },
  {
    id: 'b0009',
    name: 'Территориальное управление по Ленинскому району города Киров',
    code: '<object data="https://vgsha.info/wp-content/uploads/docs/nagrady/leninsk_territ.pdf" type="application/pdf"><embed src="https://vgsha.info/wp-content/uploads/docs/nagrady/leninsk_territ.pdf" type="application/pdf"/></object>'
  },
  {
    id: 'b0010',
    name: 'ФГБОУ ВО Вятская ГСХА',
    code: '<object data="https://vgsha.info/wp-content/uploads/docs/nagrady/vgsha.pdf" type="application/pdf"><embed src="https://vgsha.info/wp-content/uploads/docs/nagrady/vgsha.pdf" type="application/pdf"/></object>'
  }

];

const dateArr = ['30', '2', '3', '5', '6', '10'];


document.addEventListener("DOMContentLoaded", function () {
  let windowWidth = window.innerWidth;

  window.addEventListener("resize", function () {
    windowWidth = window.innerWidth;
    menuResetOnWindowResize();
  });

  const firstBlockHeight = 600;
  const goToUp = document.querySelector(".GoToUp");
  const headerNode = document.querySelector(".Header-Outer");

  fixedHeader(headerNode);
  goToUpButton(goToUp, firstBlockHeight);

  window.addEventListener("scroll", function() {
    fixedHeader(headerNode);
    goToUpButton(goToUp, firstBlockHeight);
  });

  /** init */
  showActualAnons();

  document.addEventListener("click", function (e) {
    if(e.target.classList.contains("LandingNav-Link")) {
      e.preventDefault();
      let blockForScroll = document.getElementById(e.target.dataset.toBlockId);
      blockForScroll.scrollIntoView({ block: "start", behavior: "smooth" });
    }

    if(e.target.classList.contains("LabsList-Item")) {
      e.preventDefault();
      document.querySelector(".Modal-Outer").classList.add("Modal-Outer_Show");
      document.body.classList.add('Modal_WithModalShow');
      modalInfoUpdate(getCurrentElem(e.target.dataset.labId, LabsInfo), document.querySelector('.Modal-Title'), document.querySelector('.Modal-Content'));
    }

    if(e.target.classList.contains("BadgesList-Item")) {
      e.preventDefault();
      document.querySelector(".Modal-Outer").classList.add("Modal-Outer_Show");
      document.body.classList.add('Modal_WithModalShow');
      modalInfoUpdate(getCurrentElem(e.target.dataset.badgeId, BadgesInfo), document.querySelector('.Modal-Title'), document.querySelector('.Modal-Content'));
    }

    if (e.target.classList.contains("Modal-Outer")) {
      e.target.classList.remove("Modal-Outer_Show");
      document.body.classList.remove('Modal_WithModalShow');
      modalClear();
    }
    if (e.target.classList.contains("Button_ModalClose")) {
      e.target.parentNode.parentNode.parentNode.classList.remove(
        "Modal-Outer_Show"
      );
      document.body.classList.remove('Modal_WithModalShow');
      modalClear();
    }

    if(e.target.classList.contains('AnonsList-Item')) {
      getAnonsFullInfo(e.target);
    }

    if(e.target.classList.contains('Button-Menu') || e.target.classList.contains('BgForNav')) {
      document.querySelector(".BgForNav").classList.toggle("BgForNav_Show");
      document.querySelector(".LandingNav").classList.toggle("LandingNav_Show");
      document.body.classList.toggle('Modal_WithModalShow');
    }

    if(e.target.classList.contains('Grats-Img')) {
      document.querySelector(".Modal-Outer").classList.add("Modal-Outer_Show");
      document.body.classList.add('Modal_WithModalShow');
      modalShowImg(e.target, document.querySelector('.Modal-Title'), document.querySelector('.Modal-Content'));
    }
  });

  findVideos();
});

function TopscrollTo() {
  if (window.scrollY != 0) {
    setTimeout(function () {
      window.scrollTo(0, window.scrollY - 300);
      TopscrollTo();
    }, 20);
  }
}

function fixedHeader(h) {
  if (pageYOffset > 10) {
    h.classList.add("Header_Fixed");
  } else {
    h.classList.remove("Header_Fixed");
  }
}

function goToUpButton(gtu, fbh) {
  if (pageYOffset > fbh) {
    gtu.classList.add("GoToUp_Show");
  } else {
    gtu.classList.remove("GoToUp_Show");
  }
}

function getCurrentElem(elId, elInfo) {
  const currentEl = elInfo.filter((el) => {
    if(el.id === elId) {
      return el;
    }
  });
  return currentEl;
}

function modalInfoUpdate(currEl, titleNode, contentNode) {
  //console.log('currEl[0].code', currEl[0].code);
  titleNode.innerHTML = currEl[0].name;
  contentNode.innerHTML = currEl[0].code;
}

function modalShowImg(imageNode, titleNode, contentNode) {
  titleNode.innerHTML = "Поздравление";
  contentNode.innerHTML = imageNode.innerHTML;
}

function modalClear() {
  document.querySelector('.Modal-Title').innerHTML = "";
  document.querySelector('.Modal-Content').innerHTML = "";
}

/* anons init after reload page */
function showActualAnons(date='30') {
  const fullAnons = document.querySelector('.AnonsList-FullAnons');
  const anonses = document.querySelectorAll('.AnonsList-Item');
  anonses.forEach(anons => {
    if(anons.dataset.eventDate === date) {
      anons.classList.add('AnonsList-Item_Selected');
      fullAnons.innerHTML = anons.nextElementSibling.innerHTML;
    }
  });
}

function getAnonsFullInfo(target) {
  const fullAnons = document.querySelector('.AnonsList-FullAnons');
  const anonses = document.querySelectorAll('.AnonsList-Item');
  anonses.forEach(anons => {
    anons.classList.remove('AnonsList-Item_Selected');
  });
  target.classList.add('AnonsList-Item_Selected');
  fullAnons.innerHTML = target.nextElementSibling.innerHTML;
}

const menuResetOnWindowResize = () => {
  document
    .querySelector(".Button-Menu")
    .classList.remove("MobileMenu-Button_Active");
  if(document.body.classList.contains('Modal_WithModalShow')) {
    document.body.classList.remove('Modal_WithModalShow');
  }
  document.querySelector(".LandingNav").classList.remove("LandingNav_Show");
  document.querySelector(".BgForNav").classList.remove("BgForNav_Show");
};

function findVideos() {
  let videos = document.querySelectorAll('.YtVideo');

  for (let i = 0; i < videos.length; i++) {
      setupVideo(videos[i]);
      console.log('object', videos[i]);
  }
}

function setupVideo(video) {
  let link = video.querySelector('.YtVideo-Link');
  let media = video.querySelector('.YtVideo-Media');
  let button = video.querySelector('.YtVideo-Button');
  let videoTitle = video.querySelector('.YtVideo-VideoTitle');
  let id = parseMediaURL(media);

  video.addEventListener('click', () => {
      let iframe = createIframe(id);

      link.remove();
      button.remove();
      videoTitle.remove();
      video.appendChild(iframe);
  });

  link.removeAttribute('href');
  video.classList.add('YtVideo_Enabled');
}

function parseMediaURL(media) {
  let regexp = /https:\/\/i\.ytimg\.com\/vi\/([a-zA-Z0-9_-]+)\/maxresdefault\.jpg/i;
  if(media.src.indexOf("sddefault") !== -1) {
    regexp = /https:\/\/i\.ytimg\.com\/vi\/([a-zA-Z0-9_-]+)\/sddefault\.jpg/i;
  } else if(media.src.indexOf("hqdefault") !== -1) {
    regexp = /https:\/\/i\.ytimg\.com\/vi\/([a-zA-Z0-9_-]+)\/hqdefault\.jpg/i;
  }
  let url = media.src;
  let match = url.match(regexp);

  return match[1];
}

function createIframe(id) {
  let iframe = document.createElement('iframe');

  iframe.setAttribute('allowfullscreen', '');
  iframe.setAttribute('allow', 'autoplay');
  iframe.setAttribute('src', generateURL(id));
  iframe.classList.add('YtVideo-Media');

  return iframe;
}

function generateURL(id) {
  let query = '?rel=0&showinfo=0&autoplay=1';

  return 'https://www.youtube.com/embed/' + id + query;
}

